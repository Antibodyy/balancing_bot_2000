# MPC Configuration Parameters
# Single source of truth per style_guide.md section 4.4

# Horizon parameters
prediction_horizon_steps: 40
sampling_period_s: 0.065

# Cost function weights (diagonal elements)
# State: [x, theta, psi, dx, dtheta, dpsi]
state_cost_diagonal:
  - 1.0      # x position
  - 100.0    # theta (pitch)
  - 10.0     # psi (yaw/heading)
  - 3.0      # dx (forward velocity) - tuned from sweep_balance_velocity_weights.py (best dx_mult=5)
  - 10.0     # dtheta (pitch rate)
  - 1.0      # dpsi (yaw rate)

# Control: [tau_L, tau_R]
control_cost_diagonal:
  - 0.1      # left wheel torque
  - 0.1      # right wheel torque

# Terminal cost computation
use_terminal_cost_dare: false
terminal_cost_scale: 1.0  # Scaling factor for terminal cost P (1.0 = no scaling)

# State constraints
pitch_limit_rad: 0.524              # 30 degrees
pitch_rate_limit_radps: 5.0         # match hardware capability (~286 deg/s)
velocity_limit_mps: 0.25            # limit forward drift during balance mode
velocity_limit_slack_weight: 10000.0  # soft-constraint penalty weight

# Terminal state constraints (at step N) - applied in addition to state constraints
# These values should match the computed control-invariant set from terminal_set.yaml
# See scripts/compute_terminal_set.py to compute/recompute
# Set to null to disable terminal constraints
# Values below pulled from config/simulation/terminal_set.yaml (grid_res=40 on 2025-12-12)
terminal_pitch_limit_rad: 0.524      # ~=30 deg per latest invariant set
terminal_pitch_rate_limit_radps: 3.51 # rad/s bound from terminal set sweep
terminal_velocity_limit_mps: null    # velocity unconstrained in latest set

# Control constraints
control_limit_nm: 0.25              # Motor stall torque limit

# Solver settings
solver_name: 'osqp'
warm_start_enabled: true

# Online linearization settings
online_linearization_enabled: true
preserve_warm_start_on_linearization: false
